#### ğŸ“… **Date**: 2025-03-14

#### ğŸ”– **Tags**: #Basic #BackEnd #InterviewQuestions

---

ç•¶ API éœ€è¦ç¢ºä¿ **ã€Œæ¯å€‹è«‹æ±‚åªèƒ½åŸ·è¡Œä¸€æ¬¡ï¼Œä¸èƒ½é‡è¤‡å‘¼å«ã€**ï¼Œæˆ‘å€‘å¯ä»¥æ¡å– **å»é‡ï¼ˆIdempotencyï¼‰ã€Token æ©Ÿåˆ¶ã€Redis ç·©å­˜ã€è³‡æ–™åº«è¨˜éŒ„** ç­‰æ–¹æ³•ä¾†è§£æ±ºã€‚

---

## **ğŸ“ 1. ä½¿ç”¨å”¯ä¸€è«‹æ±‚ IDï¼ˆIdempotency Keyï¼‰**

**é©ç”¨å ´æ™¯**ï¼šé˜²æ­¢ **é‡è¤‡æäº¤è¡¨å–®**ã€**äº¤æ˜“è«‹æ±‚**ï¼ˆå¦‚ä»˜æ¬¾ã€è¨‚å–®å‰µå»ºï¼‰

### **âœ… è§£æ±ºæ–¹æ¡ˆ**

- **å‰ç«¯ç”¢ç”Ÿä¸€å€‹ `idempotency-key`ï¼Œæ¯æ¬¡è«‹æ±‚å¿…é ˆå¸¶ä¸Šé€™å€‹ Key**
- **å¾Œç«¯å„²å­˜ `idempotency-key`ï¼Œå¦‚æœç›¸åŒ Key å·²å­˜åœ¨ï¼Œå‰‡æ‹’çµ•é‡è¤‡è«‹æ±‚**

### **ğŸ”¹ API è¨­è¨ˆ**

http

è¤‡è£½ç·¨è¼¯

`POST /api/orders Authorization: Bearer token123 Idempotency-Key: abc123xyz`

### **ğŸ”¹ å¾Œç«¯å¯¦ä½œï¼ˆC# .NET / Redisï¼‰**

csharp

è¤‡è£½ç·¨è¼¯

`public async Task<IActionResult> CreateOrder([FromBody] OrderRequest request, [FromHeader] string idempotencyKey) {     var cacheKey = $"idempotency:{idempotencyKey}";      // æª¢æŸ¥ Redis æ˜¯å¦å·²ç¶“è™•ç†éé€™å€‹è«‹æ±‚     if (await _redis.ExistsAsync(cacheKey))         return Conflict("æ­¤è«‹æ±‚å·²ç¶“è™•ç†ï¼Œè«‹å‹¿é‡è¤‡æäº¤");      // æ¨™è¨˜è«‹æ±‚å·²è™•ç†ï¼ˆè¨­å®šæœ‰æ•ˆæœŸé™ï¼Œä¾‹å¦‚ 10 åˆ†é˜ï¼‰     await _redis.SetAsync(cacheKey, "processed", TimeSpan.FromMinutes(10));      // åŸ·è¡Œå¯¦éš›æ¥­å‹™é‚è¼¯     var order = _orderService.CreateOrder(request);     return Ok(order); }`

ğŸ“Œ **å„ªå‹¢**

- **é©åˆä»˜æ¬¾ã€è¨‚å–®ç­‰æ¥­å‹™å ´æ™¯**
- **é˜²æ­¢ä½¿ç”¨è€…èª¤è§¸æŒ‰éˆ•é€ æˆé‡è¤‡æäº¤**

---

## **ğŸ“ 2. ä½¿ç”¨ Redis è¨˜éŒ„è«‹æ±‚ï¼ˆé˜²æ­¢çŸ­æ™‚é–“é‡è¤‡ Callï¼‰**

**é©ç”¨å ´æ™¯**ï¼šé˜²æ­¢ **ç”¨æˆ¶çŸ­æ™‚é–“å…§é‡è¤‡è«‹æ±‚**ï¼ˆå¦‚ç§’æ®ºæ´»å‹•ã€API é˜²åˆ·æ©Ÿåˆ¶ï¼‰

### **âœ… è§£æ±ºæ–¹æ¡ˆ**

- **ä½¿ç”¨ Redis è¨˜éŒ„æ¯å€‹ API è«‹æ±‚ï¼Œè¨­ç½® TTLï¼ˆTime-To-Liveï¼‰**
- **å¦‚æœçŸ­æ™‚é–“å…§è«‹æ±‚ç›¸åŒ APIï¼Œå‰‡ç›´æ¥æ‹’çµ•**

### **ğŸ”¹ å¾Œç«¯å¯¦ä½œï¼ˆC# .NET / Redisï¼‰**

csharp

è¤‡è£½ç·¨è¼¯

`public async Task<IActionResult> ProcessRequest(string userId) {     string requestKey = $"api_request:{userId}";      // æª¢æŸ¥ Redis æ˜¯å¦å·²å­˜åœ¨è©²è«‹æ±‚     if (await _redis.ExistsAsync(requestKey))         return Conflict("è«‹æ±‚å·²è™•ç†ï¼Œè«‹å‹¿é‡è¤‡è«‹æ±‚");      // è¨˜éŒ„è«‹æ±‚ï¼Œè¨­ç½® TTL 60 ç§’     await _redis.SetAsync(requestKey, "1", TimeSpan.FromSeconds(60));      return Ok("è«‹æ±‚æˆåŠŸï¼"); }`

ğŸ“Œ **å„ªå‹¢**

- **é©åˆ API Rate Limitingï¼Œé˜²æ­¢å¤šæ¬¡è«‹æ±‚**
- **ä½¿ç”¨ Redisï¼Œæ•ˆèƒ½é«˜ã€ä¸å½±éŸ¿è³‡æ–™åº«è² æ“”**

---

## **ğŸ“ 3. ä½¿ç”¨è³‡æ–™åº«å”¯ä¸€ç´„æŸï¼ˆé©ç”¨æ–¼äº¤æ˜“é¡ APIï¼‰**

**é©ç”¨å ´æ™¯**ï¼šç¢ºä¿ **è³‡æ–™åªæœƒå¯«å…¥ä¸€æ¬¡**ï¼ˆå¦‚è¨»å†Šã€æ”¯ä»˜ã€è¨‚å–®ï¼‰

### **âœ… è§£æ±ºæ–¹æ¡ˆ**

- **åœ¨è³‡æ–™åº«å…§åŠ ä¸Š `Unique Constraint`**
- **å¦‚æœè«‹æ±‚ ID é‡è¤‡ï¼Œå‰‡å›å‚³éŒ¯èª¤**

### **ğŸ”¹ SQL è¨­è¨ˆ**

sql

è¤‡è£½ç·¨è¼¯

`CREATE TABLE orders (     id SERIAL PRIMARY KEY,     user_id INT NOT NULL,     order_number VARCHAR(255) UNIQUE, -- ç¢ºä¿ä¸é‡è¤‡     amount DECIMAL(10,2) );`

### **ğŸ”¹ C# å¾Œç«¯è™•ç†**

csharp

è¤‡è£½ç·¨è¼¯

`public IActionResult CreateOrder(OrderRequest request) {     try     {         var order = new Order         {             OrderNumber = request.OrderNumber, // ç”±å‰ç«¯æä¾›             UserId = request.UserId,             Amount = request.Amount         };          _db.Orders.Add(order);         _db.SaveChanges(); // å¦‚æœ OrderNumber é‡è¤‡ï¼Œæœƒæ‹‹å‡ºéŒ¯èª¤         return Ok(order);     }     catch (DbUpdateException)     {         return Conflict("æ­¤è¨‚å–®å·²å­˜åœ¨ï¼Œè«‹å‹¿é‡è¤‡æäº¤ï¼");     } }`

ğŸ“Œ **å„ªå‹¢**

- **å³ä½¿ API ä¸¦è¡Œè«‹æ±‚ï¼Œè³‡æ–™åº«å±¤é¢ä»ç„¶ä¿è­‰å”¯ä¸€æ€§**
- **é©åˆäº¤æ˜“ã€ä»˜æ¬¾ç­‰é«˜å®‰å…¨æ€§æ“ä½œ**

---

## **ğŸ“ 4. ä½¿ç”¨ Token æ©Ÿåˆ¶ï¼ˆå‰ç«¯è«‹æ±‚ä¸€æ¬¡å¾Œå¤±æ•ˆï¼‰**

**é©ç”¨å ´æ™¯**ï¼šä¸€æ¬¡æ€§è«‹æ±‚ï¼ˆå¦‚é©—è­‰ç¢¼ã€è‡¨æ™‚æ¬Šé™ï¼‰

### **âœ… è§£æ±ºæ–¹æ¡ˆ**

1ï¸âƒ£ **å¾Œç«¯ç”¢ç”Ÿ Tokenï¼Œå‰ç«¯è«‹æ±‚ API æ™‚å¿…é ˆå¸¶ä¸Š Token**  
2ï¸âƒ£ **è«‹æ±‚å¾Œç«‹å³ä½œå»¢ï¼Œä¸å¯é‡è¤‡ä½¿ç”¨**

### **ğŸ”¹ C# å¾Œç«¯å¯¦ä½œ**

csharp

è¤‡è£½ç·¨è¼¯

`public IActionResult VerifyOnce(string token) {     if (_redis.Exists($"one_time_token:{token}"))         return Conflict("Token å·²ä½¿ç”¨ï¼Œè«‹å‹¿é‡è¤‡è«‹æ±‚");      _redis.Set($"one_time_token:{token}", "used", TimeSpan.FromMinutes(5));      return Ok("é©—è­‰æˆåŠŸï¼"); }`

ğŸ“Œ **å„ªå‹¢**

- **é©åˆä¸€æ¬¡æ€§æˆæ¬Šè«‹æ±‚**
- **é˜²æ­¢æƒ¡æ„é‡è¤‡æäº¤**

---

## **ğŸ“Œ 5. API é™åˆ¶åªèƒ½å‘¼å«ä¸€æ¬¡çš„æ–¹æ³•å°æ¯”**

|**æ–¹æ³•**|**é©ç”¨å ´æ™¯**|**å„ªå‹¢**|**ç¼ºé»**|
|---|---|---|---|
|**Idempotency Key**|**ä»˜æ¬¾ã€è¨‚å–®è«‹æ±‚**|é«˜æ•ˆé˜²æ­¢é‡è¤‡æäº¤|éœ€è¦å‰ç«¯å‚³é€å”¯ä¸€ Key|
|**Redis é˜²é‡è¤‡è«‹æ±‚**|**é˜²æ­¢ API çŸ­æ™‚é–“é‡è¤‡ Call**|è¨˜æ†¶é«”å¿«ï¼Œä¸å½±éŸ¿ DB|éœ€ä½¿ç”¨ Redis|
|**è³‡æ–™åº«å”¯ä¸€ç´„æŸ**|**äº¤æ˜“é¡æ“ä½œ**|ä¿è­‰è³‡æ–™å®Œæ•´æ€§|å½±éŸ¿è³‡æ–™åº«æ€§èƒ½|
|**ä¸€æ¬¡æ€§ Token**|**ä¸€æ¬¡æ€§é©—è­‰ï¼ˆOTPã€é©—è­‰ç¢¼ï¼‰**|å¯ç¢ºä¿è«‹æ±‚åªèƒ½ä½¿ç”¨ä¸€æ¬¡|éœ€è¦é¡å¤–ç®¡ç† Token|

---

ğŸ”¥ **é¢è©¦æŠ€å·§** å¦‚æœé¢è©¦å®˜å•ï¼šã€Œå¦‚ä½•ç¢ºä¿ API åªèƒ½è¢«å‘¼å«ä¸€æ¬¡ï¼Ÿã€  
âœ… **å›ç­”**ï¼šã€Œå¯ä»¥ä½¿ç”¨å¤šç¨®æ–¹æ³•ï¼Œå¦‚ **Idempotency Key**ï¼ˆç¢ºä¿è«‹æ±‚å”¯ä¸€ï¼‰ã€**Redis ç´€éŒ„**ï¼ˆé˜²æ­¢çŸ­æ™‚é–“å…§é‡è¤‡ Callï¼‰ã€**è³‡æ–™åº«å”¯ä¸€ç´„æŸ**ï¼ˆç¢ºä¿äº¤æ˜“ä¸é‡è¤‡ï¼‰ã€æˆ– **ä¸€æ¬¡æ€§ Token**ï¼ˆé©åˆè‡¨æ™‚æˆæ¬Šï¼‰ã€‚å…·é«”æ–¹æ¡ˆå–æ±ºæ–¼ API çš„æ¥­å‹™éœ€æ±‚ã€‚ã€